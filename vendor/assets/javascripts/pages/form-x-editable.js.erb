$(function(){
  //defaults
  $.fn.editable.defaults.url = '/policy';
  $.fn.editable.defaults.mode = 'inline';
  $.fn.editable.defaults.ajaxOptions = {type: "PATCH"};

  //editables

  $('#policy_number').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy'][params.name] = params.value
      data['id'] = params.pk;
      data[params.name] = params.value

      return data;
    },

    success: function(response, newValue) {
      $('.policy_number_display').text(newValue);
    }
  });

  $('#client_code').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy'][params.name] = params.value
      data['id'] = params.pk;
      data[params.name] = params.value

      return data;
    },

    success: function(response, newValue) {
      $('.client_code_display').text(newValue);
    }
  });

  $('#status').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy'][params.name] = params.value
      data['id'] = params.pk;
      data[params.name] = params.value

      return data;
    },

    source: [
      {value: 'Upcoming', text: 'Upcoming'},
      {value: 'Generated', text: 'Generated'},
      {value: 'Reviewed', text: 'Reviewed'},
      {value: 'Issued', text: 'Issued'}
    ],
  });

  $('#expiration_date').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy'][params.name] = params.value
      data['id'] = params.pk;
      data[params.name] = params.value

      return data;
    },

    viewformat: 'MM/DD/YYYY',
    template: 'D / MMMM / YYYY',
    combodate: {
      minYear: 1950,
      maxYear: 2050,
      minuteStep: 1
    }
  });

  $('#effective_date').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy'][params.name] = params.value
      data['id'] = params.pk;
      data[params.name] = params.value

      return data;
    },

    viewformat: 'MM/DD/YYYY',
    template: 'MMM / D / YYYY',
    combodate: {
      minYear: 1950,
      maxYear: 2050,
      minuteStep: 1
    }
  });

  $('#address').editable({
    params: function(params) {
      var data = {};
      data['policy'] = {};
      data['policy']['street'] = params.value.street;
      data['policy']['city'] = params.value.city;
      data['policy']['state'] = params.value.state;
      data['policy']['zip'] = params.value.zip;
      data['id'] = params.pk;

      return data;
    },

    validate: function(value) {
      if(value.city == '') return 'City is required!';
      if(value.state == '') return 'State is required!';
      if(value.zip == '') return 'Zip Code is required!';
      if(value.street == '') return 'Street is required!';
    }
  });

var brokers = [];

/*
[{:id=>1, :text=>"Action Group, Inc."}, {:id=>2, :text=>"Al Bourdeau Insurance Services, Inc."},
{:id=>3, :text=>"Ali T. Beydoun Insurance Agency, Inc."}, {:id=>4, :text=>"Anchor Insurance Group"},
{:id=>5, :text=>"Ann Arbor Insurance"}, {:id=>6, :text=>"Bencivenga Insurance"},
{:id=>7, :text=>"Cantor Insurance"}, {:id=>8, :text=>"Charles Walker & Associates"},
{:id=>9, :text=>"Community First Agency Inc."}, {:id=>10, :text=>"Creative Insurance Solutions, LLC"},
{:id=>11, :text=>"Custom Insurance Agency"}, {:id=>12, :text=>"DDI Insurance"},
{:id=>13, :text=>"Fawaz Insurance Agency, Inc."}, {:id=>14, :text=>"Great Lakes Bay Agency"}, {:id=>15, :text=>"Great Lakes Insurance Agency Associates"}, {:id=>16, :text=>"Haddad Insurance Corp."}, {:id=>17, :text=>"Hallmark Agency Inc."}, {:id=>18, :text=>"Harbor Country Insurance"}, {:id=>19, :text=>"Independent Insurance Services Agency"}, {:id=>20, :text=>"Insurance Advisors Inc."}, {:id=>21, :text=>"Insurance Providers of Michigan"}, {:id=>22, :text=>"JPS Insurance Agency"}, {:id=>23, :text=>"Kaplani Insurance"}, {:id=>24, :text=>"Kapnick Insurance Group"}, {:id=>25, :text=>"Kejbou Insurance Agency Inc."}, {:id=>26, :text=>"Lakepointe Insurance"}, {:id=>27, :text=>"Lind & Lind Insurance"}, {:id=>28, :text=>"Macomb-Gerlach Agency"}, {:id=>29, :text=>"Marvin F Jacobs Agency, Inc"}, {:id=>30, :text=>"Metro Financial Services LLC"}, {:id=>31, :text=>"MI Insurance Brokers"}, {:id=>32, :text=>"Michael W. Denys Agency"}, {:id=>33, :text=>"Michigan Community Insurance Agency, Inc."}, {:id=>34, :text=>"Michigan Insurance Group "}, {:id=>35, :text=>"Midwest Underwriters"}, {:id=>36, :text=>"Millennium Insurance & Investment Group"}, {:id=>37, :text=>"Morris Insurance Group"}, {:id=>38, :text=>"Mourer Foster"}, {:id=>39, :text=>"Najjar Insurance Agency"}, {:id=>40, :text=>"North Coast Insurance Services"}, {:id=>41, :text=>"NuStar Insurance Agencies, Inc"}, {:id=>42, :text=>"Peterson McGregor & Associates"}, {:id=>43, :text=>"Phil Klein Insurance Group"}, {:id=>44, :text=>"Potter & Roose Ins. Flint"}, {:id=>45, :text=>"Primary Insurance Agency Group, LLC"}, {:id=>46, :text=>"Regency Insurance Group"}, {:id=>47, :text=>"Rye Agency"}, {:id=>48, :text=>"Shears II"}, {:id=>49, :text=>"Shoemaker Group, Inc."}, {:id=>50, :text=>"Signature Insurance"}, {:id=>51, :text=>"Stu Garthe Agency, LLC"}, {:id=>52, :text=>"Summer Consulting Co."}, {:id=>53, :text=>"T.A. Conrad Agency Inc."}, {:id=>54, :text=>"Tabak Insurance Agency, PLLC"}, {:id=>55, :text=>"Tait Insurance Agency, Inc."}, {:id=>56, :text=>"TDA Insurance and Financial LLC"}, {:id=>57, :text=>"Transportation Risk Management"}, {:id=>58, :text=>"United Underwriters"}, {:id=>59, :text=>"Upper Peninsula Insurance Agency, Inc."}, {:id=>60, :text=>"Viking Insurance Agency"}, {:id=>61, :text=>"Stanbury Insurance"}, {:id=>62, :text=>"Brown-Pixley Insurance Agency"}]
*/
"<% Broker.select([:id, :name]).each do |b| %>"
  brokers.push({ id: "<%= b.id %>", text: "<%= b.name %>"})
"<% end %>"


$('#broker_id').editable({
  params: function(params) {
    var data = {};
    data['policy'] = {};
    data['policy']['broker_id'] = params.value
    data['id'] = params.pk;

    return data;
  },

  source: brokers,
  select2: {
    width: 350,
    placeholder: 'Select a Broker',
    allowClear: true
  }
});

$('.editable').editable({
  params: function(params) {
    var data = {};
    data['policy'] = {};
    data['policy'][params.name] = params.value
    data['id'] = params.pk;
    data[params.name] = params.value

    return data;
  }
});



$('#event').editable({
  placement: 'right',
  combodate: {
    firstItem: 'name'
  }
});

$('#meeting_start').editable({
  format: 'yyyy-mm-dd hh:ii',
  viewformat: 'dd/mm/yyyy hh:ii',
  validate: function(v) {
    if(v && v.getDate() == 10) return 'Day cant be 10!';
  },
  datetimepicker: {
    todayBtn: 'linked',
    weekStart: 1
  }
});

$('#comments').editable({
  showbuttons: 'bottom'
});

$('#note').editable();
$('#pencil').click(function(e) {
  e.stopPropagation();
  e.preventDefault();
  $('#note').editable('toggle');
});

$('#state').editable({
  source: ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]
});

$('#state2').editable({
  value: 'California',
  typeahead: {
    name: 'state',
    local: ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]
  }
});

$('#fruits').editable({
  pk: 1,
  limit: 3,
  source: [
    {value: 1, text: 'banana'},
    {value: 2, text: 'peach'},
    {value: 3, text: 'apple'},
    {value: 4, text: 'watermelon'},
    {value: 5, text: 'orange'}
  ]
});

$('#tags').editable({
  inputclass: 'input-large',
  select2: {
    tags: ['html', 'javascript', 'css', 'ajax'],
    tokenSeparators: [",", " "]
  }
});




$('#policy .editable').on('hidden', function(e, reason){
  if(reason === 'save' || reason === 'nochange') {
    var $next = $(this).closest('tr').next().find('.editable');
    if($('#autoopen').is(':checked')) {
      setTimeout(function() {
        $next.editable('show');
      }, 300);
    } else {
      $next.focus();
    }
  }
});
});
